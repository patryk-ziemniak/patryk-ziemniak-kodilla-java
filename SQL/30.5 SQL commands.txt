CREATE TABLE STATS (
    STAT_ID INT(11) AUTO_INCREMENT PRIMARY KEY,
    STAT_DATE DATETIME NOT NULL,
    STAT VARCHAR(20) NOT NULL,
    VALUE INT(11) NOT NULL
);

CREATE VIEW BESTSELLERS_COUNT AS
    SELECT COUNT(*) AS BESTSELLERS_COUNT FROM books WHERE BESTSELLER > 0;

DELIMITER $$

CREATE EVENT BESTSELLERS_STATS_LOG
ON SCHEDULE EVERY 1 MINUTE
DO
BEGIN
    CALL UpdateBestsellers();
    SELECT BESTSELLERS_COUNT FROM BESTSELLERS_COUNT INTO @BESTSELLERSCOUNT;
    INSERT INTO STATS (STAT_DATE, STAT, VALUE)
    VALUES (CURTIME(), 'BESTSELLERS', @BESTSELLERSCOUNT);
END $$

DELIMITER ;